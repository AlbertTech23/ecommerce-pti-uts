<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ALT Equipment</title>
    <link rel="stylesheet" href="cart.html" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="navbar.css" />
    <link rel="stylesheet" href="cart.css" />
  </head>
  <body>
    <div id="navbarContainer"></div>
    <div class="pt-5 text-center"><h1>Shopping Cart</h1></div>
    <div class="cart-parent-container p-5 ms-md-5 ms-0">
      <div class="row">
        <div class="col-md-7" id="cart-products"></div>
        <div class="col-md-1"></div>

        <div
          class="payment-details col-md-3 d-flex flex-column justify-content-center p-5 border"
          style="margin: 0 auto"
        >
          <img src="./assets/logo-black.png" alt="" class="w-25" />
          <h2>Checkout</h2>
          <h4 class="pt-3">Payment Details</h4>
          <span
            >Complete your purchase by providing your payment details
            below.</span
          >
          <div class="payment-methods pt-5">
            <h4>Payment Methods</h4>
            <select id="paymentMethod" name="paymentMethod">
              <option value="Credit Card">Credit Card</option>
              <option value="PayPal">PayPal</option>
              <option value="Bank Transfer">Bank Transfer</option>
            </select>
          </div>
          <div class="payment-info pt-5">
            <h4 class="">Total:</h4>
            <p id="total-price"></p>
          </div>
          <div class="place-order mt-4">
            <button class="btn btn-dark" onclick="checkout()">
              Place Order
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.10.2/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"></script>
    <script
      src="https://code.jquery.com/jquery-3.7.1.js"
      integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
      crossorigin="anonymous"
    ></script>

    <script>
      const navbarContainer = document.getElementById("navbarContainer");

      fetch("navbar.html")
        .then((response) => response.text())
        .then((data) => {
          navbarContainer.innerHTML = data;

          $(document).ready(function () {
            var username = sessionStorage.getItem("username");

            if (username !== null) {
              $(".nav-link[href='login.html']").hide();
              $("#usernameDisplay").text(username);
              $("#usernameDisplay").show();
            }
            setBalance(100);
            updateCartCount();
          });
        });
    </script>

    <script>
      function getBalance() {
        return document.getElementById("balanceDisplay").innerText;
      }

      function setBalance(balance) {
        document.getElementById("balanceDisplay").innerText = "$" + balance;
      }
    </script>

    <script>
      $(document).ready(function () {
        var cartSize = JSON.parse(sessionStorage.getItem("cart"));

        if (cartSize !== null) {
          $(".cart-size").text(cartSize.length);
        }
      });

      function updateCartCount() {
        let cart = JSON.parse(sessionStorage.getItem("cart")) || [];
        $(".cart-size").text(cart.length);
      }
    </script>

    <script type="module">
      import { PRODUCTS } from "./products.js";

      // Function to calculate the total price
      function calculateTotalPrice(cart) {
        let totalPrice = 0;

        // Loop through the items in the cart and calculate the total
        for (const productId of cart) {
          const product = PRODUCTS.find((p) => p.id === productId);
          if (product) {
            totalPrice += product.discountedPrice;
          }
        }

        return totalPrice.toFixed(2); // Format to two decimal places
      }

      // Update the total price on page load
      updateTotalPrice();

      function updateTotalPrice() {
        let cart = JSON.parse(sessionStorage.getItem("cart")) || [];
        const totalPrice = calculateTotalPrice(cart);

        // Update the total price element
        document.getElementById("total-price").textContent = `$${totalPrice}`;
      }

      function addToCart(productId) {
        let cart = JSON.parse(sessionStorage.getItem("cart")) || [];
        cart.push(productId);
        sessionStorage.setItem("cart", JSON.stringify(cart));
        updateCartCount();
        updateTotalPrice();
        console.log("clicked add");
      }

      function removeFromCart(productId) {
        let cart = JSON.parse(sessionStorage.getItem("cart")) || [];
        const index = cart.indexOf(productId);
        if (index !== -1) {
          cart.splice(index, 1);
          sessionStorage.setItem("cart", JSON.stringify(cart));
        }
        updateCartCount();
        updateTotalPrice();
        console.log("clicked remove");
      }

      // Replace the document.ready block with the following
      $(document).ready(function () {
        $("button[data-action='add']").on("click", function () {
          const productId = parseInt($(this).data("product-id"));
          addToCart(productId);
        });

        $("button[data-action='remove']").on("click", function () {
          const productId = parseInt($(this).data("product-id"));
          removeFromCart(productId);
        });
      });
    </script>

    <script type="module">
      import("./products.js").then(({ PRODUCTS }) => {
        let cart = JSON.parse(sessionStorage.getItem("cart")) || [];

        if (cart === null || cart.length === 0) {
          $("#cart-products").html("<p>Your cart is empty.</p>");
        } else {
          let quantities = {};

          cart.forEach((productId) => {
            quantities[productId] = (quantities[productId] || 0) + 1;
          });

          let productsHtml = "";
          for (let productId in quantities) {
            if (quantities.hasOwnProperty(productId)) {
              const product = PRODUCTS.find(
                (p) => p.id === parseInt(productId)
              );

              productsHtml += `
          <div class="cardContainer mb-3" id="product-${productId}">
            <div class="row p-5">
              <div class="col-md-4 pe-5">
                <img src="${product.productImage}" alt="${product.productName}" class="img-fluid rounded-start">
              </div>
              <div class="col-md-6">
                <div class="cart-card">
                  <h5 class="prod-title">${product.productName}</h5>
                  <p class="prod-price">$${product.discountedPrice}</p>
                </div>
              </div>
              <div class="col-md-2 d-flex flex-column justify-content-center">
                <button type="button" class="btn btn-outline-dark mb-2" data-action='add' data-product-id="${productId}" ">Add Item</button>
                 <span class="mb-2 text-center" id="quantity-${productId}">${quantities[productId]}</span>
                 <button type="button" class="btn btn-outline-danger besarin-dikit" data-action='remove' data-product-id="${productId}"">Remove</button>              </div>
            </div>
          </div>
        `;
            }
          }
          $("#cart-products").html(productsHtml);
        }
      });
    </script>
  </body>
</html>
