<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ALT Equipment</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="main.css" />
    <link rel="icon" type="image/x-icon" href="./assets/logo-white.ico" />
    <script src="navbar.js"></script>
  </head>
  <body>
    <!-- Navbar -->
    <div id="navbarContainer"></div>
    <!-- Products -->
    <div
      class="products d-flex flex-wrap p-5 m-5 justify-content-center"
      id="productList"
    ></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.10.2/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"></script>
    <script
      src="https://code.jquery.com/jquery-3.7.1.js"
      integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
      crossorigin="anonymous"
    ></script>

    <script>
      const navbarContainer = document.getElementById("navbarContainer");

      fetch("navbar.html")
        .then((response) => response.text())
        .then((data) => {
          navbarContainer.innerHTML = data;

          $(document).ready(function () {
            var username = sessionStorage.getItem("username");

            if (username !== null) {
              $(".nav-link[href='login.html']").hide();
              $("#usernameDisplay").text(username);
              $("#usernameDisplay").show();
            }

            var balance = sessionStorage.getItem("balance");
            if (balance !== null) {
              $("#balanceDisplay").text("$" + balance);
            }
            updateCartCount();
          });
        });
    </script>
    <script type="module">
      import { PRODUCTS } from "./products.js";
      function displayProducts() {
        const productList = document.getElementById("productList");

        PRODUCTS.forEach((product) => {
          const productDiv = document.createElement("div");
          productDiv.classList.add("product");
          productDiv.innerHTML = `
          <div class="product-container">
            <h2 class="fw-bold">${product.productName}</h2>
            <img class="mt-3 mb-3" src="${product.productImage}" alt="${product.productName}">
            <div class="price-container d-flex row">
              <div class="pricing col-sm">
                <p class="real-price">$${product.price}</p>
                <p class="disc-price">$${product.discountedPrice}</p>
              </div>
              <button class="col-sm" onclick="addToCart(${product.id})">Add to Cart</button>
            </div>
          </div>
          `;
          productList.appendChild(productDiv);
        });
      }
      displayProducts();
    </script>

    <script>
      function addToCart(productId) {
        let cart = JSON.parse(sessionStorage.getItem("cart"));

        if (cart === null) {
          cart = [];
        }

        cart.push(productId);

        sessionStorage.setItem("cart", JSON.stringify(cart));

        updateCartCount();
      }

      function updateCartCount() {
        let cart = JSON.parse(sessionStorage.getItem("cart"));
        $(".cart-size").text(cart.length);
      }

      updateCartCount();
    </script>
    <script>
      $(document).ready(function () {
        var cartSize = JSON.parse(sessionStorage.getItem("cart"));

        if (cartSize !== null) {
          $(".cart-size").text(cartSize.length);
        } else {
          $(".cart-size").text(0);
        }
      });
    </script>
  </body>
</html>
